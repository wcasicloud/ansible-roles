! Configuration File for keepalived

global_defs {
   notification_email {
     {{ notify_email }}
   }
   notification_email_from {{ notify_email_from }}
   smtp_server {{ smtp_server }}
   smtp_connect_timeout 30
   router_id {{ router_id }}
   vrrp_mcast_group4 {{ vrrp_mcast_group }}
}

vrrp_instance VI_1 {
    state {{ state }}
    interface {{ interface }}
    virtual_router_id  {{ virtual_router_id }}
    priority {{ priority }}
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass {{ auth_pass }}
    }
    virtual_ipaddress {
       {{ www_vip }}
    }
}

virtual_server {{ www_vip }} 443 {
    delay_loop 6
    lb_algo {{ lb_algo }}
    lb_kind {{ lb_kind }}
    nat_mask {{ nat_mask }}
    persistence_timeout 50
    protocol TCP

    real_server {{ real_server_1 }} 443 {
        weight {{ weight }}
        TCP_CHECK {
            connect_timeout 5
            nb_get_retry 3
            delay_before_retry 3
	    connect_port 443
        }
    }

    real_server {{ real_server_2 }} 443 {
        weight {{ weight }}
        TCP_CHECK {
            connect_timeout 5
            nb_get_retry 3
            delay_before_retry 3
	    connect_port 443
        }
    }
}


virtual_server {{ www_vip }} 80 {
    delay_loop 3
    lb_algo {{ lb_algo }}
    lb_kind {{ lb_kind }}
    persistence_timeout 50
    protocol TCP

    real_server {{ real_server_1 }} 80 {
        weight {{ weight }}
        HTTP_GET {
            url {
              path /
              #digest 640205b7b0fc66c1ea91c463fac6334d
              status_code 200
            }

            url {
              path {{ url_path }}
              #digest 640205b7b0fc66c1ea91c463fac6334d
	      status_code 200
            }
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
    }

    real_server {{ real_server_2 }} 80 {
    weight {{ weight }}
        HTTP_GET {
            url {
              path /
              #digest 640205b7b0fc66c1ea91c463fac6334d
	      status_code 200
            }

            url {
              path {{ url_path }}
              #digest 640205b7b0fc66c1ea91c463fac6334d
              status_code 200
            }
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
    }
}
