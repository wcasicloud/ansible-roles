# # install gcc gcc-c++ unzip
# - name: install gcc
#   yum: name=gcc state=present
# - name: install gcc-c++
#   yum: name=gcc-c++ state=present
# - name: install unzip
#   yum: name=unzip state=present
# - name: install autoconf
#   yum: name=autoconf state=present
# 
# # mkdir codis_config_dir codis_path codis_data
# - name: mkdir codis_configure_dir
#   file: dest={{ codis_configure_dir }} state=directory mode=775
# - name: mkdir codis_server
#   file: dest={{ codis_path }} state=directory mode=775
# - name: mkdir codis_data
#   file: dest={{ codis_data }} state=directory mode=775
# 
# # unarchive codis
# - name: unarchive codis-release3.2.zip
#   unarchive: src=codis-release3.2.zip dest={{ codis_configure_dir }}/
# - name: make line file for codis-release3.2
#   file: src={{ codis_configure_dir }}/codis-release3.2 dest={{ codis_configure_dir }}/codis state=link
# - name: make codis
#   shell: cd {{ codis_configure_dir }}/codis/ && make MALLOC=libc
# - name: copy codis/bin to codis_server/
#   shell: cp -a {{ codis_configure_dir }}/codis/bin {{ codis_path }}/
# #  copy: src={{ codis_configure_dir }}/codis/bin dest={{ codis_path }}/ remote_src=true directory_mode=true
# - name: copy codis_server.sh for PATH
#   template: src=codis_server.sh.j2 dest=/etc/profile.d/codis_server.sh mode=644

# config codis-server
- name: copy redis.conf
  template: src=redis.conf.j2 dest={{ codis_path }}/redis.conf
- name: start codis-server service
  shell: /app/codis/bin/codis-server /app/codis/redis.conf
- name: auto start codis-server service
  template: src=rc.local.j2 dest=/etc/rc.local mode=777


